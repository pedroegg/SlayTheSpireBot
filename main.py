#example:
"""
{
	"available_commands": [
		"play",
		"end",
		"key",
		"click",
		"wait",
		"state"
	],
	"ready_for_command": true,
	"in_game": true,
	"game_state": {
		"screen_type": "NONE",
		"screen_state": {},
		"seed": -3047511808784703000,
		"combat_state": {
			"draw_pile": [
				{
					"exhausts": false,
					"is_playable": true,
					"cost": 1,
					"name": "Strike",
					"id": "Strike_R",
					"type": "ATTACK",
					"ethereal": false,
					"uuid": "0560233c-41e8-4620-a474-d0ed627354bd",
					"upgrades": 0,
					"rarity": "BASIC",
					"has_target": true
				},
				{
					"exhausts": false,
					"is_playable": true,
					"cost": 1,
					"name": "Defend",
					"id": "Defend_R",
					"type": "SKILL",
					"ethereal": false,
					"uuid": "f8adc2a6-4d1c-4524-9044-9e2bfacf4256",
					"upgrades": 0,
					"rarity": "BASIC",
					"has_target": false
				},
				{
					"exhausts": false,
					"is_playable": true,
					"cost": 1,
					"name": "Strike",
					"id": "Strike_R",
					"type": "ATTACK",
					"ethereal": false,
					"uuid": "c6594538-debc-4085-81be-3b20a5d44062",
					"upgrades": 0,
					"rarity": "BASIC",
					"has_target": true
				},
				{
					"exhausts": false,
					"is_playable": false,
					"cost": -2,
					"name": "Ascender's Bane",
					"id": "AscendersBane",
					"type": "CURSE",
					"ethereal": true,
					"uuid": "da41cd4b-6eda-4020-a031-ad870a52b0e1",
					"upgrades": 0,
					"rarity": "SPECIAL",
					"has_target": false
				},
				{
					"exhausts": false,
					"is_playable": true,
					"cost": 1,
					"name": "Strike",
					"id": "Strike_R",
					"type": "ATTACK",
					"ethereal": false,
					"uuid": "b54d5d98-f074-4f71-b705-f071f1d44fff",
					"upgrades": 0,
					"rarity": "BASIC",
					"has_target": true
				},
				{
					"exhausts": false,
					"is_playable": true,
					"cost": 1,
					"name": "Defend",
					"id": "Defend_R",
					"type": "SKILL",
					"ethereal": false,
					"uuid": "9c10951d-0c08-46bd-bc5f-be2e1b9d53f2",
					"upgrades": 0,
					"rarity": "BASIC",
					"has_target": false
				}
			],
			"discard_pile": [],
			"exhaust_pile": [],
			"cards_discarded_this_turn": 0,
			"times_damaged": 0,
			"monsters": [
				{
					"is_gone": false,
					"move_hits": 1,
					"move_base_damage": 12,
					"half_dead": false,
					"move_adjusted_damage": -1,
					"max_hp": 46,
					"intent": "DEBUG",
					"move_id": 1,
					"name": "Jaw Worm",
					"current_hp": 1,
					"block": 0,
					"id": "JawWorm",
					"powers": []
				}
			],
			"turn": 1,
			"limbo": [],
			"hand": [
				{
					"exhausts": false,
					"is_playable": true,
					"cost": 1,
					"name": "Strike",
					"id": "Strike_R",
					"type": "ATTACK",
					"ethereal": false,
					"uuid": "7b54caef-9c56-4134-82a2-be8f1d5c435f",
					"upgrades": 0,
					"rarity": "BASIC",
					"has_target": true
				},
				{
					"exhausts": false,
					"is_playable": true,
					"cost": 1,
					"name": "Strike",
					"id": "Strike_R",
					"type": "ATTACK",
					"ethereal": false,
					"uuid": "5f9bba1a-4c54-4be7-b387-1992937c5717",
					"upgrades": 0,
					"rarity": "BASIC",
					"has_target": true
				},
				{
					"exhausts": false,
					"is_playable": true,
					"cost": 1,
					"name": "Defend",
					"id": "Defend_R",
					"type": "SKILL",
					"ethereal": false,
					"uuid": "0dbea551-c9ae-4228-8821-74e2ffd04889",
					"upgrades": 0,
					"rarity": "BASIC",
					"has_target": false
				},
				{
					"exhausts": false,
					"is_playable": true,
					"cost": 1,
					"name": "Defend",
					"id": "Defend_R",
					"type": "SKILL",
					"ethereal": false,
					"uuid": "612c16f7-f8f7-4253-88bb-ab4813d34b69",
					"upgrades": 0,
					"rarity": "BASIC",
					"has_target": false
				},
				{
					"exhausts": false,
					"is_playable": true,
					"cost": 2,
					"name": "Bash",
					"id": "Bash",
					"type": "ATTACK",
					"ethereal": false,
					"uuid": "41e3754b-d2e3-40b4-a83b-f165b1943ec3",
					"upgrades": 0,
					"rarity": "BASIC",
					"has_target": true
				}
			],
			"player": {
				"orbs": [],
				"current_hp": 68,
				"block": 0,
				"max_hp": 75,
				"powers": [],
				"energy": 3
			}
		},
		"deck": [
			{
				"exhausts": false,
				"is_playable": false,
				"cost": -2,
				"name": "Ascender's Bane",
				"id": "AscendersBane",
				"type": "CURSE",
				"ethereal": true,
				"uuid": "da41cd4b-6eda-4020-a031-ad870a52b0e1",
				"upgrades": 0,
				"rarity": "SPECIAL",
				"has_target": false
			},
			{
				"exhausts": false,
				"is_playable": true,
				"cost": 1,
				"name": "Strike",
				"id": "Strike_R",
				"type": "ATTACK",
				"ethereal": false,
				"uuid": "7b54caef-9c56-4134-82a2-be8f1d5c435f",
				"upgrades": 0,
				"rarity": "BASIC",
				"has_target": true
			},
			{
				"exhausts": false,
				"is_playable": true,
				"cost": 1,
				"name": "Strike",
				"id": "Strike_R",
				"type": "ATTACK",
				"ethereal": false,
				"uuid": "c6594538-debc-4085-81be-3b20a5d44062",
				"upgrades": 0,
				"rarity": "BASIC",
				"has_target": true
			},
			{
				"exhausts": false,
				"is_playable": true,
				"cost": 1,
				"name": "Strike",
				"id": "Strike_R",
				"type": "ATTACK",
				"ethereal": false,
				"uuid": "5f9bba1a-4c54-4be7-b387-1992937c5717",
				"upgrades": 0,
				"rarity": "BASIC",
				"has_target": true
			},
			{
				"exhausts": false,
				"is_playable": true,
				"cost": 1,
				"name": "Strike",
				"id": "Strike_R",
				"type": "ATTACK",
				"ethereal": false,
				"uuid": "0560233c-41e8-4620-a474-d0ed627354bd",
				"upgrades": 0,
				"rarity": "BASIC",
				"has_target": true
			},
			{
				"exhausts": false,
				"is_playable": true,
				"cost": 1,
				"name": "Strike",
				"id": "Strike_R",
				"type": "ATTACK",
				"ethereal": false,
				"uuid": "b54d5d98-f074-4f71-b705-f071f1d44fff",
				"upgrades": 0,
				"rarity": "BASIC",
				"has_target": true
			},
			{
				"exhausts": false,
				"is_playable": true,
				"cost": 1,
				"name": "Defend",
				"id": "Defend_R",
				"type": "SKILL",
				"ethereal": false,
				"uuid": "9c10951d-0c08-46bd-bc5f-be2e1b9d53f2",
				"upgrades": 0,
				"rarity": "BASIC",
				"has_target": false
			},
			{
				"exhausts": false,
				"is_playable": true,
				"cost": 1,
				"name": "Defend",
				"id": "Defend_R",
				"type": "SKILL",
				"ethereal": false,
				"uuid": "0dbea551-c9ae-4228-8821-74e2ffd04889",
				"upgrades": 0,
				"rarity": "BASIC",
				"has_target": false
			},
			{
				"exhausts": false,
				"is_playable": true,
				"cost": 1,
				"name": "Defend",
				"id": "Defend_R",
				"type": "SKILL",
				"ethereal": false,
				"uuid": "612c16f7-f8f7-4253-88bb-ab4813d34b69",
				"upgrades": 0,
				"rarity": "BASIC",
				"has_target": false
			},
			{
				"exhausts": false,
				"is_playable": true,
				"cost": 1,
				"name": "Defend",
				"id": "Defend_R",
				"type": "SKILL",
				"ethereal": false,
				"uuid": "f8adc2a6-4d1c-4524-9044-9e2bfacf4256",
				"upgrades": 0,
				"rarity": "BASIC",
				"has_target": false
			},
			{
				"exhausts": false,
				"is_playable": true,
				"cost": 2,
				"name": "Bash",
				"id": "Bash",
				"type": "ATTACK",
				"ethereal": false,
				"uuid": "41e3754b-d2e3-40b4-a83b-f165b1943ec3",
				"upgrades": 0,
				"rarity": "BASIC",
				"has_target": true
			}
		],
		"relics": [
			{
				"name": "Burning Blood",
				"id": "Burning Blood",
				"counter": -1
			},
			{
				"name": "Neow's Lament",
				"id": "NeowsBlessing",
				"counter": 2
			}
		],
		"max_hp": 75,
		"act_boss": "The Guardian",
		"gold": 99,
		"action_phase": "WAITING_ON_USER",
		"act": 1,
		"screen_name": "NONE",
		"room_phase": "COMBAT",
		"is_screen_up": false,
		"potions": [
			{
				"requires_target": false,
				"can_use": false,
				"can_discard": false,
				"name": "Potion Slot",
				"id": "Potion Slot"
			},
			{
				"requires_target": false,
				"can_use": false,
				"can_discard": false,
				"name": "Potion Slot",
				"id": "Potion Slot"
			}
		],
		"current_hp": 68,
		"floor": 1,
		"ascension_level": 20,
		"class": "IRONCLAD",
		"map": [
			{
				"symbol": "M",
				"children": [
					{
						"x": 0,
						"y": 1
					}
				],
				"x": 1,
				"y": 0,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 2,
						"y": 1
					}
				],
				"x": 2,
				"y": 0,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 4,
						"y": 1
					}
				],
				"x": 3,
				"y": 0,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 5,
						"y": 1
					}
				],
				"x": 6,
				"y": 0,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 1,
						"y": 2
					}
				],
				"x": 0,
				"y": 1,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 1,
						"y": 2
					},
					{
						"x": 2,
						"y": 2
					}
				],
				"x": 2,
				"y": 1,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 3,
						"y": 2
					}
				],
				"x": 4,
				"y": 1,
				"parents": []
			},
			{
				"symbol": "$",
				"children": [
					{
						"x": 4,
						"y": 2
					}
				],
				"x": 5,
				"y": 1,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 1,
						"y": 3
					},
					{
						"x": 2,
						"y": 3
					}
				],
				"x": 1,
				"y": 2,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 2,
						"y": 3
					},
					{
						"x": 3,
						"y": 3
					}
				],
				"x": 2,
				"y": 2,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 3,
						"y": 3
					}
				],
				"x": 3,
				"y": 2,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 5,
						"y": 3
					}
				],
				"x": 4,
				"y": 2,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 1,
						"y": 4
					}
				],
				"x": 1,
				"y": 3,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 3,
						"y": 4
					}
				],
				"x": 2,
				"y": 3,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 3,
						"y": 4
					}
				],
				"x": 3,
				"y": 3,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 4,
						"y": 4
					}
				],
				"x": 5,
				"y": 3,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 1,
						"y": 5
					}
				],
				"x": 1,
				"y": 4,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 2,
						"y": 5
					},
					{
						"x": 3,
						"y": 5
					}
				],
				"x": 3,
				"y": 4,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 3,
						"y": 5
					}
				],
				"x": 4,
				"y": 4,
				"parents": []
			},
			{
				"symbol": "E",
				"children": [
					{
						"x": 1,
						"y": 6
					}
				],
				"x": 1,
				"y": 5,
				"parents": []
			},
			{
				"symbol": "E",
				"children": [
					{
						"x": 1,
						"y": 6
					},
					{
						"x": 2,
						"y": 6
					}
				],
				"x": 2,
				"y": 5,
				"parents": []
			},
			{
				"symbol": "R",
				"children": [
					{
						"x": 2,
						"y": 6
					},
					{
						"x": 3,
						"y": 6
					}
				],
				"x": 3,
				"y": 5,
				"parents": []
			},
			{
				"symbol": "R",
				"children": [
					{
						"x": 2,
						"y": 7
					}
				],
				"x": 1,
				"y": 6,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 2,
						"y": 7
					},
					{
						"x": 3,
						"y": 7
					}
				],
				"x": 2,
				"y": 6,
				"parents": []
			},
			{
				"symbol": "E",
				"children": [
					{
						"x": 3,
						"y": 7
					}
				],
				"x": 3,
				"y": 6,
				"parents": []
			},
			{
				"symbol": "E",
				"children": [
					{
						"x": 1,
						"y": 8
					},
					{
						"x": 2,
						"y": 8
					},
					{
						"x": 3,
						"y": 8
					}
				],
				"x": 2,
				"y": 7,
				"parents": []
			},
			{
				"symbol": "R",
				"children": [
					{
						"x": 3,
						"y": 8
					}
				],
				"x": 3,
				"y": 7,
				"parents": []
			},
			{
				"symbol": "T",
				"children": [
					{
						"x": 0,
						"y": 9
					}
				],
				"x": 1,
				"y": 8,
				"parents": []
			},
			{
				"symbol": "T",
				"children": [
					{
						"x": 1,
						"y": 9
					}
				],
				"x": 2,
				"y": 8,
				"parents": []
			},
			{
				"symbol": "T",
				"children": [
					{
						"x": 2,
						"y": 9
					},
					{
						"x": 3,
						"y": 9
					},
					{
						"x": 4,
						"y": 9
					}
				],
				"x": 3,
				"y": 8,
				"parents": []
			},
			{
				"symbol": "R",
				"children": [
					{
						"x": 1,
						"y": 10
					}
				],
				"x": 0,
				"y": 9,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 1,
						"y": 10
					}
				],
				"x": 1,
				"y": 9,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 1,
						"y": 10
					},
					{
						"x": 3,
						"y": 10
					}
				],
				"x": 2,
				"y": 9,
				"parents": []
			},
			{
				"symbol": "R",
				"children": [
					{
						"x": 4,
						"y": 10
					}
				],
				"x": 3,
				"y": 9,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 4,
						"y": 10
					}
				],
				"x": 4,
				"y": 9,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 0,
						"y": 11
					},
					{
						"x": 1,
						"y": 11
					}
				],
				"x": 1,
				"y": 10,
				"parents": []
			},
			{
				"symbol": "R",
				"children": [
					{
						"x": 3,
						"y": 11
					}
				],
				"x": 3,
				"y": 10,
				"parents": []
			},
			{
				"symbol": "E",
				"children": [
					{
						"x": 3,
						"y": 11
					},
					{
						"x": 4,
						"y": 11
					}
				],
				"x": 4,
				"y": 10,
				"parents": []
			},
			{
				"symbol": "$",
				"children": [
					{
						"x": 0,
						"y": 12
					}
				],
				"x": 0,
				"y": 11,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 1,
						"y": 12
					}
				],
				"x": 1,
				"y": 11,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 3,
						"y": 12
					},
					{
						"x": 4,
						"y": 12
					}
				],
				"x": 3,
				"y": 11,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 4,
						"y": 12
					}
				],
				"x": 4,
				"y": 11,
				"parents": []
			},
			{
				"symbol": "E",
				"children": [
					{
						"x": 0,
						"y": 13
					}
				],
				"x": 0,
				"y": 12,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 1,
						"y": 13
					}
				],
				"x": 1,
				"y": 12,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 3,
						"y": 13
					}
				],
				"x": 3,
				"y": 12,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 3,
						"y": 13
					}
				],
				"x": 4,
				"y": 12,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 1,
						"y": 14
					}
				],
				"x": 0,
				"y": 13,
				"parents": []
			},
			{
				"symbol": "M",
				"children": [
					{
						"x": 1,
						"y": 14
					}
				],
				"x": 1,
				"y": 13,
				"parents": []
			},
			{
				"symbol": "?",
				"children": [
					{
						"x": 2,
						"y": 14
					},
					{
						"x": 3,
						"y": 14
					}
				],
				"x": 3,
				"y": 13,
				"parents": []
			},
			{
				"symbol": "R",
				"children": [
					{
						"x": 3,
						"y": 16
					}
				],
				"x": 1,
				"y": 14,
				"parents": []
			},
			{
				"symbol": "R",
				"children": [
					{
						"x": 3,
						"y": 16
					}
				],
				"x": 2,
				"y": 14,
				"parents": []
			},
			{
				"symbol": "R",
				"children": [
					{
						"x": 3,
						"y": 16
					}
				],
				"x": 3,
				"y": 14,
				"parents": []
			}
		],
		"room_type": "MonsterRoom"
	}
}
"""

import pathlib
import logging
logging.basicConfig(filename=pathlib.Path(__file__).with_suffix('.log'), level=logging.INFO, format='%(message)s')

import sys
import json
from datetime import datetime

from spirecomm.spire.game import Game, RoomPhase
from spirecomm.spire.character import Character, Intent, Monster, Orb, Player, PlayerClass, Power
from spirecomm.communication.coordinator import Coordinator
from spirecomm.communication.action import (
	Action, BossRewardAction, BuyCardAction, BuyPotionAction, BuyPurgeAction, BuyRelicAction, CancelAction,
	CardRewardAction, CardSelectAction, ChooseAction, ChooseMapBossAction, ChooseMapNodeAction, ChooseShopkeeperAction,
	CombatRewardAction, EndTurnAction, EventOptionAction, OpenChestAction, OptionalCardSelectConfirmAction, PlayCardAction,
	PotionAction, ProceedAction, RestAction, RewardType, ScreenType, StartGameAction, StateAction
)

#c = Coordinator()

def on_error(error: str) -> Action:
	logging.error(error)
	return StateAction

def out_of_game() -> Action:
	logging.info('Out of the game')
	return StateAction

def state_change(game_state: Game) -> Action:
	logging.info(f'Game state changed: {game_state}')
	return StateAction

def send(cmd: str) -> None:
	sys.stdout.write(cmd + '\n')
	sys.stdout.flush()

def main() -> None:
	send('ready')

	#c.register_command_error_callback(on_error)
	#c.register_out_of_game_callback(out_of_game)
	#c.register_state_change_callback(state_change)

	# handshake
	#c.signal_ready()

	#victory = c.play_one_game(PlayerClass.IRONCLAD, 0)
	#logging.info(f'Game over! Victory: {victory}')

	#f not victory:
		#c.add_action_to_queue(CancelAction)
		#c.add_action_to_queue(CancelAction)
		#c.add_action_to_queue(CancelAction)

	for raw in sys.stdin:
		raw = raw.strip()
		if not raw:
			continue

		try:
			state = json.loads(raw)
		except Exception as e:
			logging.error(f'failed to parse JSON: {raw}')
			continue

		logging.info(json.dumps(state, indent=2, ensure_ascii=False))

	# manda um comando de volta
	send("state")



	# manda um comando de volta
	#c.send_message('END')

	#começa a executar as ações (ele chama sem parar a func execute_next_action_if_ready e receive_game_state_update)
	#use isso se quiser só ir rodando ações
	#c.run()

	#c.add_action_to_queue(BuyCardAction)
	#c.clear_actions()
	#c.execute_next_action()
	#c.execute_next_action_if_ready()

	#pega a próxima mensagem. Param block faz esperar até a próxima mensagem sem avançar o fluxo
	#c.get_next_raw_message(block=True)

	#usa a próxima mensagem para atualizar o estado do jogo. Param block faz esperar até a próxima mensagem sem avançar fluxo
	#c.receive_game_state_update(block=True)

if __name__ == "__main__":
	main()



"""
for raw in sys.stdin:
	raw = raw.strip()
	if not raw:
		continue

	try:
		state = json.loads(raw)
	except Exception as e:
		logging.error(f'failed to parse JSON: {raw}')
		continue

	logging.info(json.dumps(state, indent=2, ensure_ascii=False))
"""